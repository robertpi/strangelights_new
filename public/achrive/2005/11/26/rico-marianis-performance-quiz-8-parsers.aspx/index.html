<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width">
		

		<title>Rico Mariani’s performance quiz 8 - Parsers</title>

		
		<link rel="stylesheet" href="http://strangelights.com/css/colors-dark.min.217a2547e8e6c808986d22ef70b50263c2d6a4bbc80ed42e97e280a41103f9b5.css">

		
	</head>
	<body>
		<header id="header">
			<h1><a href="http://strangelights.com/">Strangelights</a></h1>
			<p></p>
		</header>

		<div id="page">
			<div id="sidebar">
				<nav>
	
</nav>

			</div>

			<div id="content">
				
	<article class="post">
		<h1><a href="http://strangelights.com/achrive/2005/11/26/rico-marianis-performance-quiz-8-parsers.aspx/">Rico Mariani’s performance quiz 8 - Parsers</a> </h1>

		<div class="post-content">

<p><P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>The snow is falling over Saint Germain en Laye and it makes everything look really pretty, but I have absolutely no whish to go outside, so I sit in the flat and what it fall and write this blog entry instead.&lt;?xml:namespace prefix = o ns = &ldquo;urn:schemas-microsoft-com:office:office&rdquo; /&gt;<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>I&#8217;ve been following Rico Mariani&#8217;s performance quizzes for a while now and always found them interesting. The <A href="http://blogs.msdn.com/ricom/archive/2005/11/22/495874.aspx">latest quiz on the performance of a parse</A>, reminded me of a famous CS quote that every large software project has badly implement lisp engine in it. However I know little about lisp so I thought I&#8217;d have a stab at reimplementing it in F#. OCaml, the language that inspired F#, has a reputation for being as fast as C++, so it would be great if F# could gain the reputation for being as fast C#, so that in mind I setout with ambition of beating Rico&rsquo;s implementation. <o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>After puzzling over the code for a short while I released while I could copy in F# it fairly easily, as it easy to write imperative style code in F#, it would be difficult translate it and keep a good functional style. So used fslex and fsyacc F#&#8217;s parse generator tools and quickly released the language was so simple I could implement it almost entirely inside fslex and fsyacc. <o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>Here&#8217;s my lexer:<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>let whitespace = [&rsquo; &lsquo; &lsquo;\t&rsquo; ]<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>let newline = (&rsquo;\n&rsquo; | &lsquo;\r&rsquo; &lsquo;\n&rsquo;)<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><o:p><FONT face=Verdana>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>rule token = parse<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| whitespace<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ token lexbuf }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| newline { newline lexbuf; token lexbuf }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| &ldquo;|&rdquo;<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ OR }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| &ldquo;&amp;&ldquo;<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ AND }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| &ldquo;!&rdquo;<SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ NOT }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| &ldquo;(&rdquo;<SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ OPENBRACKET }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| &ldquo;)&rdquo;<SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ CLOSEBRACKET }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| [&lsquo;a&rsquo;-&lsquo;z&rsquo;][&lsquo;a&rsquo;-&lsquo;z&rdquo;0&rsquo;-&lsquo;9&rsquo;]*<SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>{ ID(lexeme lexbuf) }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>| eof<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>{ EOF }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>And here&#8217;s the parser:<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>start: expr EOF { $1 }<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><o:p><FONT face=Verdana>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>expr:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>expr OR expr { $1 or $3 } <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>expr AND expr { $1 &amp; $3 } <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>NOT expr { not $2 } <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>OPENBRACKET expr CLOSEBRACKET { $2 } <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB"><FONT face=Verdana>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>ID { is_true2 $1 } <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>And that&#8217;s basically it theres a small F# module, which I used to pass in the predicated, but other wise its all in the fslex and fsyacc modules.<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>Unfortunately the resulting times showed it to clocks in at 100&nbsp;000 ms, about a factor of 10 slow than Rico&#8217;s implementation which clocks in at about 9&nbsp;000 ms on my laptop.<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>F&hellip; Fiddle sticks.<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>Anyway, it obviously going to be difficult to micro tune the code generated code, but with a factor of 10 to remove we need a more radical approach than micro tuning. Two things occur to me: I vaguely remember from my CS class that that code gened lexers are generally much faster than hand coded lexers, but code generated parsers are generally slower. Also I notice that Rico strictly evaluates his predicates, but if they truly are predicate then they could be lazily evaluated. With that in mind a rip off the parser and replace it with a hand code recursive decent parser.<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>Here is the parser definition:<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; mso-no-proof: yes"><o:p><FONT face=Verdana>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><FONT face=Verdana><SPAN lang=EN-GB style="FONT-SIZE: 8pt; COLOR: blue; mso-ansi-language: EN-GB; mso-no-proof: yes">type</SPAN><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"> token = <o:p><a href="/o:p">/o:p</a></SPAN></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Or_token<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>And_token<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><FONT face=Verdana><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN></SPAN><SPAN style="FONT-SIZE: 8pt; mso-no-proof: yes">| Not_token<o:p><a href="/o:p">/o:p</a></SPAN></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>| Open_bracket<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>| Close_bracket<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>| Id <SPAN style="COLOR: blue">of</SPAN> string<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>| Eof<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><o:p><FONT face=Verdana>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><FONT face=Verdana><SPAN lang=EN-GB style="FONT-SIZE: 8pt; COLOR: blue; mso-ansi-language: EN-GB; mso-no-proof: yes">exception</SPAN><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"> SyntaxError<o:p><a href="/o:p">/o:p</a></SPAN></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><FONT face=Verdana><SPAN lang=EN-GB style="FONT-SIZE: 8pt; COLOR: blue; mso-ansi-language: EN-GB; mso-no-proof: yes">let</SPAN><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"> <SPAN style="COLOR: blue">rec</SPAN> eval (currentState : bool option) (t1 : token) (nextToken : unit <SPAN style="COLOR: blue">-&gt;</SPAN> token) = <o:p><a href="/o:p">/o:p</a></SPAN></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">match</SPAN> t1 <SPAN style="COLOR: blue">with<o:p><a href="/o:p">/o:p</a></SPAN></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| And_token <SPAN style="COLOR: blue">-&gt;</SPAN> <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>(<SPAN style="COLOR: blue">match</SPAN> currentState <SPAN style="COLOR: blue">with</SPAN> <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Some(<SPAN style="COLOR: blue">true</SPAN>) <SPAN style="COLOR: blue">-&gt;</SPAN> <SPAN style="COLOR: blue">let</SPAN> next = nextToken() <SPAN style="COLOR: blue">in</SPAN> eval currentState next nextToken<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Some(<SPAN style="COLOR: blue">false</SPAN>) <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: blue">false<o:p><a href="/o:p">/o:p</a></SPAN></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| None <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>raise SyntaxError)<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Or_token <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>(<SPAN style="COLOR: blue">match</SPAN> currentState <SPAN style="COLOR: blue">with</SPAN> <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Some(<SPAN style="COLOR: blue">true</SPAN>) <SPAN style="COLOR: blue">-&gt;</SPAN> <SPAN style="COLOR: blue">false<o:p><a href="/o:p">/o:p</a></SPAN></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Some(<SPAN style="COLOR: blue">false</SPAN>) <SPAN style="COLOR: blue">-&gt;</SPAN> <SPAN style="COLOR: blue">let</SPAN> next = nextToken() <SPAN style="COLOR: blue">in</SPAN> eval currentState next nextToken <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| None <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>raise SyntaxError)<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Not_token <SPAN style="COLOR: blue">-&gt;</SPAN> not (<SPAN style="COLOR: blue">let</SPAN> next = nextToken() <SPAN style="COLOR: blue">in</SPAN> eval currentState next nextToken)<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Open_bracket <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: blue">let</SPAN> next = nextToken() <SPAN style="COLOR: blue">in</SPAN> eval None next nextToken<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Close_bracket <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>(<SPAN style="COLOR: blue">match</SPAN> currentState <SPAN style="COLOR: blue">with</SPAN> | Some(x) <SPAN style="COLOR: blue">-&gt;</SPAN> x | None <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>raise SyntaxError) <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Eof <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>(<SPAN style="COLOR: blue">match</SPAN> currentState <SPAN style="COLOR: blue">with</SPAN> <o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Some(x) <SPAN style="COLOR: blue">-&gt;</SPAN> x<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| None <SPAN style="COLOR: blue">-&gt;</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>raise SyntaxError)<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>| Id(s1) <SPAN style="COLOR: blue">-&gt;</SPAN> <SPAN style="COLOR: blue">let</SPAN> next = nextToken() <SPAN style="COLOR: blue">in</SPAN> eval (Some(is_true2 s1)) next nextToken<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>The resulting program had an execution time of around 50&nbsp;000ms, close but no cigar. However, now that I lazily evaluate the predicates I know that the results are heavily depend on the test data, complex predicates will favour my parser, while simpler ones will favour Rico&#8217;s and our current data set is pretty simple. I retest with various data sets and find that as complexity increase, the times for my parse rise much more slowly.<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>I eventually find that the following data set:<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><FONT face=Verdana><SPAN lang=EN-GB style="FONT-SIZE: 8pt; COLOR: blue; mso-ansi-language: EN-GB; mso-no-proof: yes">let</SPAN><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"> predicates = [|<o:p><a href="/o:p">/o:p</a></SPAN></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;((fact1 &amp; fact2) &amp; (fact3 &amp; fact4)) | ((fact5 &amp; fact6) &amp; (fact7 &amp; fact8))&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;((fact8 &amp; fact7) &amp; (fact6 &amp; fact5)) | ((fact4 &amp; fact3) &amp; (fact2 &amp; fact1))&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;(fact2 &amp; fact1) &amp; (fact2 &amp; fact1)&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;!((fact5 &amp; fact6) &amp; (fact7 &amp; fact8)) &amp; ((fact9 &amp; fact10) &amp; (fact11 &amp; fact12))&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;(fact2 &amp; fact1) | (fact2 &amp; fact1)&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;(fact3 &amp; fact2) | ((fact3 &amp; fact2) &amp; (fact3 &amp; fact2))&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;(fact9 | fact10) | (fact11 | fact12)&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;(!fact4 &amp; fact5) &amp; (((!fact6 &amp; fact7) &amp; (!fact8 &amp; fact9)) &amp; ((!fact10 &amp; fact11) &amp; (!fact12 &amp; fact13)))&rdquo;</SPAN>;<o:p><a href="/o:p">/o:p</a></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><FONT face=Verdana><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: maroon">&rdquo;(!(fact1 &amp; fact2) | !fact3) | (((!(fact4 &amp; fact5) | !fact6) | (!(fact7 &amp; fact8) | !fact9)) | ((!(fact10 &amp; fact11) | !fact12) | (!(fact13 &amp; fact14) | !fact15)))&rdquo;<o:p><a href="/o:p">/o:p</a></SPAN></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt; mso-layout-grid-align: none"><FONT face=Verdana><SPAN lang=EN-GB style="FONT-SIZE: 8pt; mso-ansi-language: EN-GB; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN><SPAN style="FONT-SIZE: 8pt; mso-no-proof: yes">|]<o:p><a href="/o:p">/o:p</a></SPAN></FONT></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>Which takes Rico&#8217;s parser 72&nbsp;398 ms and mine 64 407 ms. I win. Well sort of.<o:p><a href="/o:p">/o:p</a></FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><FONT face=Verdana size=2>&nbsp;</FONT><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>In all serious, it would be a nicer test to write a small program that can randomly generate predicates of various complexity and measure the results as the complexity increase.</FONT></FONT></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><a href="/o:p">/o:p</a></SPAN>&nbsp;</P><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><FONT size=2><FONT face=Verdana>The full source is available <A href="http://www.strangelights.com/download.aspx?url=/blog/downloads/ParserPerf.zip">here</A>.&nbsp;</FONT></FONT></SPAN>&nbsp;<a href="/o:p">/o:p</a></SPAN></P><SPAN lang=EN-GB style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana; mso-ansi-language: EN-GB; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-fareast-language: FR; mso-bidi-language: AR-SA">
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><a href="/o:p">/o:p</a></SPAN>&nbsp;</P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt">Well maybe I&#8217;ll do that later but &hellip; but now it&#8217;s looking like there maybe enough snow to build a snow man, so I might venture outside after all.</SPAN></P><SPAN lang=EN-GB style="FONT-SIZE: 10pt; FONT-FAMILY: Verdana; mso-ansi-language: EN-GB; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-fareast-language: FR; mso-bidi-language: AR-SA"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB">
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p><a href="/o:p">/o:p</a></SPAN>&nbsp;<SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><o:p>&nbsp;<a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"><SPAN lang=EN-GB style="mso-ansi-language: EN-GB"><STRONG>Update:</STRONG> I&#8217;ve also added to the download to include a version of the parser rewritten by <A href="http://blogs.msdn.com/dsyme/">Don Syme</A> which was originally posted to the <A href="http://list.research.microsoft.com/scripts/lyris.pl?enter=fsharp">F# mailing list</A>. Now just an impressive 78 lines of code versus 259 for the original C# version, which is a pretty impressive line count saving. This is especially true&nbsp;when you consider that the code is still very readable, in fact for my money it much easier to understand the F# version of the code as its much clearer what each component of the code is doing.<o:p><a href="/o:p">/o:p</a></SPAN></P>
<P class=MsoNormal style="MARGIN: 0cm 0cm 0pt"></SPAN></P></SPAN></SPAN></p>

<h3 id="feedback">Feedback:</h3>

<p><em>Feedback was imported from my only blog engine, it&rsquo;s no longer possible to post feedback here.</em></p>

<p><strong>re: Rico Mariani’s performance quiz 8 - Parsers - <a href="http://strangelights.com/blog">Robert Pickering</a></strong></p>

<p>If your reading this post you proably should take a look at this too:
<br><a target="_new" href="http://strangelights.com/blog/archive/2005/11/29/1269.aspx"><a href="http://strangelights.com/blog/archive/2005/11/29/1269.aspx">http://strangelights.com/blog/archive/2005/11/29/1269.aspx</a></a>
<br>
<br>More to follow soon.</p>

<p><strong>re: Rico Mariani’s performance quiz 8 - Parsers - Paul Hatcher</strong></p>

<p>There were some papers published in Software Practice &amp; Experience about 1985 by Uni Karlruhr regarding the cost of generated lexers/parsers.
<br>
<br>The trick on the lexer is to touch the characters as little as possible and to this end you switch on the first character of the lexeme, this recognises a large number tokens that you typically get in programming languages and then have a second switch if its trying to recognise identifiers/numbers etc.
<br>
<br>Also important is to use the symbol table as the means of recognising keywords rather than explicitly recognising them in the lexer.
<br>
<br>This gives you a core lexer that is better than most hand-cranked ones and is configurable</p>
</div>

		<p class="meta">Posted on <span class="postdate">26. November 2005</span></p>
	</article>

			</div>

			<footer id="footer">
				<p class="copyright">
					
						Powered by <a href="https://gohugo.io/">Hugo</a> and the
						<a href="https://github.com/bake/solar-theme-hugo">Solar</a>-theme.
					
				</p>
			</footer>
		</div>

		
	</body>
</html>
